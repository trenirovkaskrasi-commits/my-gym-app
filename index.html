<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ê–ë–û–ù–ê–ú–ï–ù–¢–ò</title>
    <link rel="manifest" href="manifest.json">
    <style>
        /* –ú–ï–¢–†–û –î–ò–ó–ê–ô–ù –°–ò–°–¢–ï–ú–ê */
        :root {
            --accent: #0078D7;
            --bg: #ffffff;
            --text: #000000;
            --tile: #eff2f5;
            --green: #267a26;
            --blue: #005a9e;
            --red: #a80000;
            --purple: #7232ad;
            --dark-red: #8b0000;
            --font-main: 'Segoe UI', 'Open Sans', sans-serif;
        }

        [data-theme="dark"] {
            --bg: #000000;
            --text: #ffffff;
            --tile: #1a1a1a;
        }

        * {
            box-sizing: border-box;
            border-radius: 0 !important;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            color: var(--text);
            font-family: var(--font-main);
            user-select: none;
            overflow-x: hidden;
        }

        header {
            background-color: var(--accent);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .container {
            padding: 10px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* –¢–ê–ô–õ–û–í–ï (METRO TILES) */
        .klient-tile {
            background-color: var(--tile);
            display: grid;
            grid-template-columns: 80px 1fr 60px;
            align-items: center;
            padding: 10px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: transform 0.1s;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .klient-tile:active {
            transform: scale(0.98);
            background-color: #ddd;
        }

        .klient-photo {
            width: 70px;
            height: 70px;
            object-fit: cover;
            background-color: #ccc;
            border: 1px solid #888;
        }

        .klient-info {
            padding-left: 15px;
        }

        .klient-name {
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
        }

        .status-badge {
            display: inline-block;
            font-size: 0.7rem;
            font-weight: 900;
            padding: 2px 6px;
            margin-top: 4px;
            text-transform: uppercase;
        }

        .active-status { background-color: var(--green); color: white; }
        .inactive-status { background-color: var(--red); color: white; }

        .rem-count {
            font-size: 1.8rem;
            font-weight: 900;
            text-align: right;
            color: var(--accent);
        }

        /* –§–û–†–ú–ò */
        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background-color: var(--tile);
            border: 2px solid #ccc;
            color: var(--text);
            font-size: 1rem;
            font-weight: bold;
        }

        input:focus {
            border-color: var(--accent);
            outline: none;
        }

        .btn {
            border: none;
            padding: 16px;
            color: white;
            font-weight: 900;
            font-size: 1rem;
            text-transform: uppercase;
            cursor: pointer;
            display: block;
            width: 100%;
            margin-bottom: 10px;
            transition: opacity 0.2s;
        }

        .btn:active { opacity: 0.8; }
        .btn-green { background-color: var(--green); }
        .btn-blue { background-color: var(--blue); }
        .btn-red { background-color: var(--red); }
        .btn-purple { background-color: var(--purple); }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 65px;
            height: 65px;
            background-color: var(--accent);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 35px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 999;
        }

        /* –°–ï–ö–¶–ò–ò */
        .view { display: none; }
        .view.active { display: block; }

        /* –ê–ë–û–ù–ê–ú–ï–ù–¢–ù–ò –î–ï–¢–ê–ô–õ–ò */
        .profile-header {
            text-align: center;
            padding: 20px;
            background-color: var(--tile);
            margin-bottom: 15px;
        }

        .profile-img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border: 4px solid var(--accent);
            margin-bottom: 10px;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-box {
            background-color: var(--tile);
            padding: 15px;
            text-align: center;
        }

        .stat-val {
            font-size: 1.5rem;
            font-weight: 900;
            display: block;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body data-theme="light">

<header>
    <div style="font-weight: 900; font-size: 1.2rem; letter-spacing: 1px;">GYM MANAGER</div>
    <div onclick="pokajiSektsiya('view-settings')" style="cursor: pointer; font-size: 1.5rem;">‚öôÔ∏è</div>
</header>

<div class="container">
    
    <div id="view-main" class="view active">
        <input type="text" id="search-input" placeholder="–¢–™–†–°–ò –ö–õ–ò–ï–ù–¢..." oninput="renderList()">
        <div id="klient-list-container"></div>
        <div class="fab" onclick="otvoriDobavyane()">+</div>
    </div>

    <div id="view-add" class="view">
        <h2 id="view-add-title" style="text-transform: uppercase; border-left: 5px solid var(--accent); padding-left: 10px;">–ù–æ–≤ –ö–ª–∏–µ–Ω—Ç</h2>
        
        <label style="font-size: 0.8rem; font-weight: bold; color: #666;">–°–ù–ò–ú–ö–ê</label>
        <input type="file" id="inp-photo" accept="image/*" onchange="obrabotiSnimka(this)">
        <div id="photo-preview-container" style="text-align: center; margin-bottom: 15px; display: none;">
            <img id="img-preview" style="width: 100%; max-height: 200px; object-fit: cover; border: 1px solid #ccc;">
        </div>

        <input type="text" id="inp-name" placeholder="–ò–ú–ï –ò –§–ê–ú–ò–õ–ò–Ø">
        <input type="tel" id="inp-phone" placeholder="–¢–ï–õ–ï–§–û–ù">
        <input type="email" id="inp-email" placeholder="EMAIL (–û–ü–¶–ò–Ø)">

        <div id="subscription-fields">
            <label style="font-size: 0.8rem; font-weight: bold; color: #666;">–ü–ê–ö–ï–¢ –¢–†–ï–ù–ò–†–û–í–ö–ò</label>
            <select id="sel-paket" onchange="izchisliTsena()">
                <option value="8">8 –¢–†–ï–ù–ò–†–û–í–ö–ò</option>
                <option value="10">10 –¢–†–ï–ù–ò–†–û–í–ö–ò</option>
                <option value="12" selected>12 –¢–†–ï–ù–ò–†–û–í–ö–ò</option>
                <option value="16">16 –¢–†–ï–ù–ò–†–û–í–ö–ò</option>
                <option value="20">20 –¢–†–ï–ù–ò–†–û–í–ö–ò</option>
            </select>

            <label style="font-size: 0.8rem; font-weight: bold; color: #666;">–°–†–û–ö –ù–ê –í–ê–õ–ò–î–ù–û–°–¢</label>
            <select id="sel-srok" onchange="izchisliTsena()">
                <option value="30" selected>30 –î–ù–ò</option>
                <option value="45">45 –î–ù–ò</option>
                <option value="60">60 –î–ù–ò</option>
                <option value="90">90 –î–ù–ò</option>
            </select>

            <label style="font-size: 0.8rem; font-weight: bold; color: #666;">–û–¢–°–¢–™–ü–ö–ê (%)</label>
            <select id="sel-otstapka" onchange="izchisliTsena()">
                <option value="0" selected>–ë–ï–ó –û–¢–°–¢–™–ü–ö–ê</option>
                <option value="5">5%</option>
                <option value="10">10%</option>
                <option value="20">20%</option>
            </select>

            <div style="background: var(--tile); padding: 15px; margin-bottom: 15px; text-align: center; border: 2px dashed var(--accent);">
                <span style="font-size: 0.8rem; color: #666;">–ö–†–ê–ô–ù–ê –¶–ï–ù–ê:</span><br>
                <span id="final-price" style="font-size: 1.8rem; font-weight: 900; color: var(--accent);">0.00 –ª–≤.</span>
            </div>
        </div>

        <button class="btn btn-blue" onclick="zapaziKlient()">–ó–ê–ü–ê–ó–ò –ö–õ–ò–ï–ù–¢</button>
        <button class="btn btn-red" onclick="pokajiSektsiya('view-main')">–û–¢–ö–ê–ó</button>
    </div>

    <div id="view-profile" class="view">
        <div id="profile-content"></div>
        
        <button id="btn-markiraj" class="btn btn-green" onclick="markirajTrenirovka()" style="font-size: 1.2rem; padding: 20px;">–ú–ê–†–ö–ò–†–ê–ô –¢–†–ï–ù–ò–†–û–í–ö–ê</button>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button class="btn btn-blue" onclick="podnoviAbonament()">–ü–û–î–ù–û–í–ò</button>
            <button class="btn btn-purple" onclick="generirajOtchet()">–í–∞–π–±—ä—Ä –û—Ç—á–µ—Ç</button>
        </div>
        
        <button class="btn btn-red" onclick="iztriiKlient()" style="padding: 10px; font-size: 0.8rem;">–ò–ó–¢–†–ò–ô –ö–õ–ò–ï–ù–¢</button>
        <button class="btn btn-blue" onclick="pokajiSektsiya('view-main')">–û–ë–†–ê–¢–ù–û</button>
    </div>

    <div id="view-settings" class="view">
        <h2 style="text-transform: uppercase; border-left: 5px solid var(--accent); padding-left: 10px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
        
        <label>–¢–ï–ú–ê</label>
        <select onchange="smeniTemu(this.value)">
            <option value="light">–°–í–ï–¢–õ–ê</option>
            <option value="dark">–¢–™–ú–ù–ê</option>
        </select>

        <label>–¶–ï–ù–ê –ù–ê –ï–î–ò–ù–ò–ß–ù–ê –¢–†–ï–ù–ò–†–û–í–ö–ê (–ª–≤.)</label>
        <input type="number" id="set-trenirovka-price" value="10" oninput="zapaziNastroiki()">

        <label>GOOGLE SCRIPT URL (doGet)</label>
        <input type="text" id="set-gas-url" placeholder="https://script.google.com/macros/s/.../exec" oninput="zapaziNastroiki()">

        <hr style="margin: 20px 0;">
        
        <button class="btn btn-green" onclick="sinhroniziraj()">–°–ò–ù–•–†–û–ù–ò–ó–ò–†–ê–ô –°–ï–ì–ê</button>
        <button class="btn btn-purple" onclick="eksportDanni()">–ï–ö–°–ü–û–†–¢ (–ë–ï–ö–™–ü)</button>
        <button class="btn btn-blue" onclick="importDanni()">–ò–ú–ü–û–†–¢ (RESTORE)</button>
        
        <button class="btn btn-red" onclick="pokajiSektsiya('view-main')">–ó–ê–¢–í–û–†–ò</button>
    </div>

</div>

<script>
/* –õ–û–ì–ò–ö–ê –ò –î–ê–ù–ù–ò */
let klienti = JSON.parse(localStorage.getItem('gym_klienti')) || [];
let nastroiki = JSON.parse(localStorage.getItem('gym_settings')) || {
    theme: 'light',
    price: 10,
    gasUrl: ''
};

let tekushtKlientId = null;
let snimkaBase64 = "";
let rezhimRedaktirane = false;

function init() {
    document.body.setAttribute('data-theme', nastroiki.theme);
    document.getElementById('set-trenirovka-price').value = nastroiki.price;
    document.getElementById('set-gas-url').value = nastroiki.gasUrl || '';
    renderList();
}

function renderList() {
    const query = document.getElementById('search-input').value.toLowerCase();
    const container = document.getElementById('klient-list-container');
    container.innerHTML = "";

    const filtered = klienti.filter(k => k.name.toLowerCase().includes(query));

    filtered.forEach(k => {
        const ost = k.abonament.broi - k.abonament.napraveni;
        const isExpired = ost <= 0 || (new Date(k.abonament.krainaData.split('.').reverse().join('-')) < new Date());
        
        const tile = document.createElement('div');
        tile.className = 'klient-tile';
        tile.onclick = () => otvoriProfil(k.id);
        
        tile.innerHTML = `
            <img src="${k.photo || 'https://via.placeholder.com/80'}" class="klient-photo">
            <div class="klient-info">
                <div class="klient-name">${k.name}</div>
                <span class="status-badge ${!isExpired ? 'active-status' : 'inactive-status'}">
                    ${!isExpired ? '–ê–ö–¢–ò–í–ï–ù' : '–ò–ó–¢–ï–ö–™–õ'}
                </span>
                <div style="font-size: 0.7rem; color: #888; margin-top: 2px;">–î–æ: ${k.abonament.krainaData}</div>
            </div>
            <div class="rem-count">${ost}</div>
        `;
        container.appendChild(tile);
    });
}

function pokajiSektsiya(id) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo(0,0);
}

function otvoriDobavyane() {
    tekushtKlientId = null;
    rezhimRedaktirane = false;
    snimkaBase64 = "";
    document.getElementById('view-add-title').innerText = "–ù–æ–≤ –ö–ª–∏–µ–Ω—Ç";
    document.getElementById('subscription-fields').classList.remove('hidden');
    document.getElementById('inp-name').value = "";
    document.getElementById('inp-phone').value = "";
    document.getElementById('inp-email').value = "";
    document.getElementById('photo-preview-container').style.display = 'none';
    izchisliTsena();
    pokajiSektsiya('view-add');
}

function obrabotiSnimka(input) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            snimkaBase64 = e.target.result;
            document.getElementById('img-preview').src = snimkaBase64;
            document.getElementById('photo-preview-container').style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
}

function izchisliTsena() {
    const broi = parseInt(document.getElementById('sel-paket').value);
    const otstapka = parseInt(document.getElementById('sel-otstapka').value);
    let total = broi * nastroiki.price;
    total = total - (total * (otstapka / 100));
    document.getElementById('final-price').innerText = total.toFixed(2) + " –ª–≤.";
}

function zapaziKlient() {
    const name = document.getElementById('inp-name').value.trim();
    if (!name) { alert("–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ!"); return; }

    if (rezhimRedaktirane && tekushtKlientId) {
        // –†–ï–î–ê–ö–¶–ò–Ø
        let k = klienti.find(x => x.id === tekushtKlientId);
        k.name = name;
        k.phone = document.getElementById('inp-phone').value;
        k.email = document.getElementById('inp-email').value;
        if (snimkaBase64) k.photo = snimkaBase64;
    } else {
        // –ù–û–í
        const broi = parseInt(document.getElementById('sel-paket').value);
        const srok = parseInt(document.getElementById('sel-srok').value);
        const otstapka = parseInt(document.getElementById('sel-otstapka').value);
        
        const start = new Date();
        const kraj = new Date();
        kraj.setDate(start.getDate() + srok);

        const novKlient = {
            id: Date.now(),
            name: name,
            phone: document.getElementById('inp-phone').value,
            email: document.getElementById('inp-email').value,
            photo: snimkaBase64,
            abonament: {
                broi: broi,
                napraveni: 0,
                startData: start.toLocaleDateString('bg-BG'),
                krainaData: kraj.toLocaleDateString('bg-BG'),
                otstapka: otstapka,
                tsena: document.getElementById('final-price').innerText
            },
            history: []
        };
        klienti.push(novKlient);
    }

    localStorage.setItem('gym_klienti', JSON.stringify(klienti));
    renderList();
    pokajiSektsiya('view-main');
    playBeep();
}

function otvoriProfil(id) {
    tekushtKlientId = id;
    const k = klienti.find(x => x.id === id);
    const ost = k.abonament.broi - k.abonament.napraveni;
    
    let historyHtml = k.history.slice(0, 5).map(h => `<div style="font-size:0.8rem; border-bottom:1px solid #ddd; padding:5px;">${h}</div>`).join('');

    document.getElementById('profile-content').innerHTML = `
        <div class="profile-header">
            <img src="${k.photo || 'https://via.placeholder.com/150'}" class="profile-img">
            <h2 style="margin:0; text-transform:uppercase;">${k.name}</h2>
            <div style="color:var(--accent); font-weight:bold;">${k.phone || '–ù—è–º–∞ —Ç–µ–ª–µ—Ñ–æ–Ω'}</div>
        </div>
        
        <div class="stat-grid">
            <div class="stat-box">
                <span class="stat-label">–û—Å—Ç–∞–≤–∞—â–∏</span>
                <span class="stat-val" style="color:var(--accent); font-size:2.5rem;">${ost}</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">–í–∞–ª–∏–¥–µ–Ω –¥–æ</span>
                <span class="stat-val" style="font-size:1.1rem; margin-top:10px;">${k.abonament.krainaData}</span>
            </div>
        </div>

        <div style="background:var(--tile); padding:10px; margin-bottom:15px;">
            <div class="stat-label" style="margin-bottom:5px;">–ü–æ—Å–ª–µ–¥–Ω–∏ 5 –ø–æ—Å–µ—â–µ–Ω–∏—è:</div>
            ${historyHtml || '–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∏ –ø–æ—Å–µ—â–µ–Ω–∏—è'}
        </div>
    `;
    
    document.getElementById('btn-markiraj').disabled = (ost <= 0);
    pokajiSektsiya('view-profile');
}

function markirajTrenirovka() {
    const k = klienti.find(x => x.id === tekushtKlientId);
    if (k.abonament.napraveni < k.abonament.broi) {
        k.abonament.napraveni++;
        const d = new Date();
        k.history.unshift(d.toLocaleDateString('bg-BG') + " " + d.toLocaleTimeString('bg-BG', {hour: '2-digit', minute:'2-digit'}));
        
        localStorage.setItem('gym_klienti', JSON.stringify(klienti));
        playBeep();
        otvoriProfil(tekushtKlientId);
    }
}

function podnoviAbonament() {
    rezhimRedaktirane = false;
    const k = klienti.find(x => x.id === tekushtKlientId);
    document.getElementById('view-add-title').innerText = "–ü–æ–¥–Ω–æ–≤—è–≤–∞–Ω–µ: " + k.name;
    document.getElementById('inp-name').value = k.name;
    document.getElementById('inp-phone').value = k.phone;
    document.getElementById('inp-email').value = k.email;
    document.getElementById('subscription-fields').classList.remove('hidden');
    pokajiSektsiya('view-add');
}

function iztriiKlient() {
    if (confirm("–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–æ–∑–∏ –∫–ª–∏–µ–Ω—Ç –∏ –Ω–µ–≥–æ–≤–∞—Ç–∞ –∏—Å—Ç–æ—Ä–∏—è?")) {
        klienti = klienti.filter(x => x.id !== tekushtKlientId);
        localStorage.setItem('gym_klienti', JSON.stringify(klienti));
        renderList();
        pokajiSektsiya('view-main');
    }
}

function zapaziNastroiki() {
    nastroiki.price = parseFloat(document.getElementById('set-trenirovka-price').value);
    nastroiki.gasUrl = document.getElementById('set-gas-url').value;
    localStorage.setItem('gym_settings', JSON.stringify(nastroiki));
}

function smeniTemu(val) {
    nastroiki.theme = val;
    document.body.setAttribute('data-theme', val);
    zapaziNastroiki();
}

function playBeep() {
    try {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + 0.1);
    } catch(e) {}
}

/* –°–ò–ù–•–†–û–ù–ò–ó–ò–†–ê–ù–ï –ß–†–ï–ó DOGET */
async function sinhroniziraj() {
    const url = nastroiki.gasUrl;
    if (!url) {
        alert("–ú–æ–ª—è, –ø–æ—Å—Ç–∞–≤–µ—Ç–µ Google Script URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ!");
        return;
    }

    // –û–ª–µ–∫–æ—Ç—è–≤–∞–º–µ –¥–∞–Ω–Ω–∏—Ç–µ (–ø—Ä–µ–º–∞—Ö–≤–∞–º–µ —Å–Ω–∏–º–∫–∏—Ç–µ –∑–∞ –±–µ–∫—ä–ø–∞)
    const dataToSync = klienti.map(k => {
        const { photo, ...rest } = k;
        return rest;
    });

    try {
        const finalUrl = url + "?data=" + encodeURIComponent(JSON.stringify(dataToSync));
        
        // –ò–∑–ø–æ–ª–∑–≤–∞–º–µ Image Beacon –º–µ—Ç–æ–¥–∞ - –Ω–∞–π-—Å—Ç–∞–±–∏–ª–Ω–∏—è—Ç –∑–∞ doGet
        const img = new Image();
        img.onload = () => alert("–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è—Ç–∞ –ø—Ä–∏–∫–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ!");
        img.onerror = () => alert("–î–∞–Ω–Ω–∏—Ç–µ —Å–∞ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∏ –∫—ä–º —Ç–∞–±–ª–∏—Ü–∞—Ç–∞!");
        img.src = finalUrl;
        
    } catch (e) {
        alert("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: " + e.message);
    }
}

function eksportDanni() {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(klienti));
    const dl = document.createElement('a'); dl.setAttribute("href", dataStr);
    dl.setAttribute("download", "gym_backup.json"); dl.click();
}

function importDanni() {
    const input = document.createElement('input'); input.type = 'file';
    input.onchange = e => {
        const file = e.target.files[0]; const reader = new FileReader();
        reader.readAsText(file, 'UTF-8');
        reader.onload = re => {
            klienti = JSON.parse(re.target.result);
            localStorage.setItem('gym_klienti', JSON.stringify(klienti));
            renderList(); alert("–î–∞–Ω–Ω–∏—Ç–µ —Å–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω–∏!");
        }
    }
    input.click();
}

function generirajOtchet() {
    const k = klienti.find(x => x.id === tekushtKlientId);
    const ost = k.abonament.broi - k.abonament.napraveni;
    const text = `üìä –û–¢–ß–ï–¢ –¢–†–ï–ù–ò–†–û–í–ö–ò\nüë§ –ö–ª–∏–µ–Ω—Ç: ${k.name}\n‚úÖ –ù–∞–ø—Ä–∞–≤–µ–Ω–∏: ${k.abonament.napraveni}\nüîú –û—Å—Ç–∞–≤–∞—â–∏: ${ost}\nüìÖ –í–∞–ª–∏–¥–µ–Ω –¥–æ: ${k.abonament.krainaData}`;
    window.location.href = `viber://forward?text=${encodeURIComponent(text)}`;
}

init();

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ Service Worker –∑–∞ PWA
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(err => console.log('SW error:', err));
    });
}
</script>
</body>
</html>
